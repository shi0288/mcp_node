var async = require('async');
var prop = require('mcp_config').prop;
var esdb = require('easy_db');
var Database = esdb.Database;
var Table = esdb.Table;
var Column = esdb.Column;


var esut = require("easy_util");
var log = esut.log;

var DbCenter = function () {
    var self = this;
};

DbCenter.prototype.init = function (cb) {
    var self = this;
    esdb.log.setShowLog(true);
    async.waterfall([
        //the mysql
        function (cb) {
            self._initMain(function (err) {
                if (!err) {
                    log.info('-----数据库初始化完成')
                } else {
                    log.error('-----数据库初始化失败')
                }
                cb(err);
            });
        },
        //the mongodb
        function (cb) {
            self._initMg(function (err) {
                if (!err) {
                    log.info('-----MongoDB初始化完成')
                } else {
                    log.error('-----MongoDB初始化失败')
                }
                cb(err);
            });
        }
    ], function (err, result) {
        cb(err);
    });
};

DbCenter.prototype.check = function (cb) {
    var self = this;
    async.waterfall([
        //check the mysql
        function (cb) {
            self._checkMain(function (err) {
                if (!err) {
                    log.info('-----数据库检查项完成')
                } else {
                    log.error('-----数据库检查项失败')
                }
                cb(err);
            });
        },
        //check the mongodb
        function (cb) {
            self._checkMg(function (err) {
                if (!err) {
                    log.info('-----MongoDB检查项完成')
                } else {
                    log.error('-----MongoDB检查项失败')
                }
                cb(err);
            });
        }
    ], function (err, result) {
        cb(err);
    });
};

DbCenter.prototype._initMain = function (cb) {
    var self = this;
    var db = new Database(prop.main);
    //add tables
    var loan = new Table(db, "loan", [
        new Column(db, "id", "varchar", 32, true, undefined, true, false),
        new Column(db, "name", "varchar", 50, false, undefined),
        new Column(db, "repay_user_id", "varchar", 32, false, undefined),
        new Column(db, "borrow_user_id", "varchar", 32, false, undefined),
        new Column(db, "repay_type", "varchar", 32, false, undefined),
        new Column(db, "deadline", "int", -1, false, undefined),
        new Column(db, "agreement", "varchar", 32, false, undefined),
        new Column(db, "live_money", "int", -1, false, undefined),
        new Column(db, "live_deadline", "int", -1, false, undefined),
        new Column(db, "live_start", "date", -1, false, undefined),
        new Column(db, "live_end", "date", -1, false, undefined),
        new Column(db, "money", "int", -1, false, undefined),
        new Column(db, "loan_money", "int", -1, false, undefined),
        new Column(db, "min_invest", "int", -1, false, undefined),
        new Column(db, "max_invest", "int", -1, false, undefined),
        new Column(db, "raise_invest", "int", -1, false, undefined),
        new Column(db, "rate", "double", -1, false, undefined),
        new Column(db, "st_rate", "double", -1, false, undefined),
        new Column(db, "advance_penalty", "double", -1, false, undefined),
        new Column(db, "over_penalty", "double", -1, false, undefined),
        new Column(db, "over_interest", "double", -1, false, undefined),
        new Column(db, "loan_type", "varchar", 32, false, undefined),
        new Column(db, "contract_id", "varchar", 32, false, undefined),
        new Column(db, "accrue_time", "date", -1, false, undefined),
        new Column(db, "final_time", "date", -1, false, undefined),
        new Column(db, "day_month", "varchar", 5, false, undefined),
        new Column(db, "raise_time", "date", -1, false, undefined),
        new Column(db, "activity", "varchar", 32, false, undefined),
        new Column(db, "loan_info_id", "varchar", 32, false, undefined),
        new Column(db, "status", "int", -1, false, undefined),
        new Column(db, "transfer_time", "date", -1, false, undefined),
        new Column(db, "finish_time", "date", -1, false, undefined),
        new Column(db, "create_time", "date", -1, false, undefined)
    ]);
    db.put(loan);

    var managelog = new Table(db, "managelog", [
        new Column(db, "id", "varchar", 32, false, undefined, true, false),
        new Column(db, "create_time", "date", -1, false, undefined),
        new Column(db, "des", "varchar", 50, false, undefined),
        new Column(db, "user_id", "varchar", 32, false, undefined)
    ]);
    db.put(managelog);

    var dict = new Table(db, "dict", [
        new Column(db, "id", "varchar", 32, false, undefined, true, false),
        new Column(db, "pid", "varchar", 100, false, undefined),
        new Column(db, "code", "varchar", 100, false, undefined),
        new Column(db, "name", "varchar", 500, false, undefined),
        new Column(db, "status", "int", -1, false, undefined),
        new Column(db, "type", "int", -1, false, undefined),
        new Column(db, "seqnum", "int", -1, false, undefined)
    ]);
    db.put(dict);


    var repay_type = new Table(db, "repay_type", [
        new Column(db, "id", "varchar", 32, false, undefined, true, false),
        new Column(db, "name", "varchar", 100, false, undefined),
        new Column(db, "description", "varchar", 1000, false, undefined),
        new Column(db, "point", "int", -1, false, undefined),
        new Column(db, "type", "varchar", 100, false, undefined),
        new Column(db, "unit", "varchar", 10, false, undefined)
    ]);
    db.put(repay_type);

    var invest = new Table(db, "invest", [
        new Column(db, "id", "varchar", 32, false, undefined, true, false),
        new Column(db, "money", "int", -1, false, undefined),
        new Column(db, "interest", "int", -1, false, undefined),
        new Column(db, "status", "int", -1, false, undefined),
        new Column(db, "rate", "double", -1, false, undefined),
        new Column(db, "o_rate", "double", -1, false, undefined),
        new Column(db, "st_rate", "double", -1, false, undefined),
        new Column(db, "create_time", "date", -1, false, undefined),
        new Column(db, "o_interest", "int", -1, false, undefined),
        new Column(db, "st_interest", "int", -1, false, undefined),
        new Column(db, "coupon_money", "int", -1, false, undefined),
        new Column(db, "loan_id", "varchar", 32, false, undefined),
        new Column(db, "user_id", "varchar", 32, false, undefined),
        new Column(db, "transfer_user", "varchar", 32, false, undefined),
        new Column(db, "transfer_time", "date", -1, false, undefined),
        new Column(db, "channel", "varchar", 32, false, undefined)
    ]);
    db.put(invest);

    var invest_repay = new Table(db, "invest_repay", [
        new Column(db, "id", "varchar", 32, false, undefined, true, false),
        new Column(db, "money", "int", -1, false, undefined),
        new Column(db, "interest", "int", -1, false, undefined),
        new Column(db, "tran_money", "double", -1, false, undefined),
        new Column(db, "tran_interest", "double", -1, false, undefined),
        new Column(db, "st_interest", "int", -1, false, undefined),
        new Column(db, "repay_day", "date", -1, false, undefined),
        new Column(db, "invest_id", "varchar", 32, false, undefined),
        new Column(db, "fee", "int", -1, false, undefined),
        new Column(db, "penalty", "int", -1, false, undefined),
        new Column(db, "period", "int", -1, false, undefined),
        new Column(db, "status", "int", -1, false, undefined),
        new Column(db, "all_period", "int", -1, false, undefined),
        new Column(db, "advance_penalty", "int", -1, false, undefined),
        new Column(db, "create_time", "date", -1, false, undefined)
    ]);
    db.put(invest_repay);

    var loan_repay = new Table(db, "loan_repay", [
        new Column(db, "id", "varchar", 32, false, undefined, true, false),
        new Column(db, "money", "int", -1, false, undefined),
        new Column(db, "interest", "int", -1, false, undefined),
        new Column(db, "st_interest", "int", -1, false, undefined),
        new Column(db, "repay_day", "date", -1, false, undefined),
        new Column(db, "loan_id", "varchar", 32, false, undefined),
        new Column(db, "fee", "int", -1, false, undefined),
        new Column(db, "penalty", "int", -1, false, undefined),
        new Column(db, "status", "int", -1, false, undefined),
        new Column(db, "all_period", "int", -1, false, undefined),
        new Column(db, "period", "int", -1, false, undefined),
        new Column(db, "advance_penalty", "int", -1, false, undefined),
        new Column(db, "create_time", "date", -1, false, undefined)
    ]);
    db.put(loan_repay);


    var account = new Table(db, "account", [
        new Column(db, "id", "varchar", 32, false, undefined, true, false),
        new Column(db, "money", "int", -1, false, undefined),
        new Column(db, "frozen_money", "double", -1, false, undefined),
        new Column(db, "user_id", "varchar", 32, false, undefined),
        new Column(db, "create_time", "date", -1, false, undefined),
        new Column(db, "update_time", "date", -1, false, undefined)
    ]);
    db.put(account);


    var user = new Table(db, "user", [
        new Column(db, "id", "varchar", 32, false, undefined, true, false),
        new Column(db, "username", "varchar", 50, false, undefined),
        new Column(db, "password", "varchar", 100, false, undefined),
        new Column(db, "status", "int", -1, false, undefined),
        new Column(db, "email", "varchar", 100, false, undefined),
        new Column(db, "realname", "varchar", 100, false, undefined),
        new Column(db, "sex", "int", -1, false, undefined),
        new Column(db, "birthday", "date", -1, false, undefined),
        new Column(db, "mobile", "varchar", 18, false, undefined),
        new Column(db, "card", "varchar", 20, false, undefined),
        new Column(db, "createTime", "date", -1, false, undefined),
        new Column(db, "photo", "varchar", 500, false, undefined),
        new Column(db, "referrer", "varchar", 32, false, undefined),
        new Column(db, "qq", "varchar", 20, false, undefined),
        new Column(db, "permission", "int", -1, false, undefined),
        new Column(db, "authentication", "int", -1, false, undefined),
        new Column(db, "baofoo", "bigint", -1, false, undefined),
        new Column(db, "updateTime", "date", -1, false, undefined)
    ]);
    db.put(user);

    var menu = new Table(db, "menu", [
        new Column(db, "id", "varchar", 32, false, undefined, true, false),
        new Column(db, "name", "varchar", 100, false, undefined),
        new Column(db, "type", "varchar", 20, false, undefined),
        new Column(db, "url", "varchar", 1000, false, undefined),
        new Column(db, "description", "varchar", 1000, false, undefined),
        new Column(db, "status", "int", -1, false, undefined),
        new Column(db, "level", "int", -1, false, undefined),
        new Column(db, "pid", "varchar", 32, false, undefined),
        new Column(db, "seqnum", "int", -1, false, undefined)
    ]);
    db.put(menu);

    var role_menu = new Table(db, "role_menu", [
        new Column(db, "role_id", "varchar", 32, false, undefined, true, false),
        new Column(db, "menu_id", "varchar", 32, false, undefined, true, false)
    ]);
    db.put(role_menu);

    var user_role = new Table(db, "user_role", [
        new Column(db, "role_id", "varchar", 32, false, undefined, true, false),
        new Column(db, "user_id", "varchar", 32, false, undefined, true, false)
    ]);
    db.put(user_role);

    var role = new Table(db, "role", [
        new Column(db, "id", "varchar", 32, false, undefined, true, false),
        new Column(db, "name", "varchar", 100, false, undefined),
        new Column(db, "description", "varchar", 1000, false, undefined)
    ]);
    db.put(role);

    var node = new Table(db, "node",[
        new Column(db, "id", "varchar", 32, false, undefined, true, false),
        new Column(db, "title", "varchar", 100, true, undefined),
        new Column(db, "subtitle", "varchar", 100, true, undefined),
        new Column(db, "body", "longtext", -1, true, undefined),
        new Column(db, "status", "varchar", 20, false, undefined),
        new Column(db, "keywords", "text", -1, true, undefined),
        new Column(db, "description", "text", -1, true, undefined),
        new Column(db, "version", "double", -1, true, undefined),
        new Column(db, "create_time", "date", -1, false, undefined),
        new Column(db, "update_time", "date", -1, false, undefined),
        new Column(db, "creator", "varchar", 32, false, undefined),
        new Column(db, "last_modify_user", "varchar", 32, true, undefined),
        new Column(db, "seq_num", "int", 11, true, undefined),
        new Column(db, "thumb", "varchar", 80, true, undefined),
        new Column(db, "category_term_code", "varchar", 10, false, undefined)
    ]);
    db.put(node);
    var request_info = new Table(db, "request_info", [
        new Column(db, "id", "varchar", 32, false, undefined, true, false),
        new Column(db, "req_no", "varchar", 50, false, undefined),
        new Column(db, "request_data", "longtext", -1, false, undefined),
        new Column(db, "request_time", "date", -1, false, undefined),
        new Column(db, "response_data", "longtext", -1, false, undefined),
        new Column(db, "response_time", "date", -1, false, undefined),
        new Column(db, "status", "int", -1, false, undefined),
        new Column(db, "request_url", "varchar", 1024, false, undefined),
        new Column(db, "username", "varchar", 50, false, undefined),
        new Column(db, "trusteeship", "varchar", 50, false, undefined),
        new Column(db, "type", "varchar", 50, false, undefined)
    ]);
    db.put(request_info);


    var recharge = new Table(db, "recharge", [
        new Column(db, "id", "varchar", 32, false, undefined, true, false),
        new Column(db, "user_id", "varchar", 32, false, undefined, true, false),
        new Column(db, "money", "int", -1, false, undefined),
        new Column(db, "fee", "int", -1, false, undefined),
        new Column(db, "actual_money", "int", -1, false, undefined),
        new Column(db, "description", "varchar", 1024, undefined),
        new Column(db, "req_no", "varchar", 50, false, undefined),
        new Column(db, "success_time", "date", -1, false, undefined),
        new Column(db, "create_time", "date", -1, false, undefined),
        new Column(db, "status", "int", -1, false, undefined),
        new Column(db, "type", "varchar", 50, false, undefined)
    ]);
    db.put(recharge);

    var withdraw = new Table(db, "withdraw", [
        new Column(db, "id", "varchar", 32, false, undefined, true, false),
        new Column(db, "user_id", "varchar", 32, false, undefined, true, false),
        new Column(db, "money", "int", -1, false, undefined),
        new Column(db, "fee", "int", -1, false, undefined),
        new Column(db, "actual_money", "int", -1, false, undefined),
        new Column(db, "req_no", "varchar", 50, false, undefined),
        new Column(db, "success_time", "date", -1, false, undefined),
        new Column(db, "create_time", "date", -1, false, undefined),
        new Column(db, "status", "int", -1, false, undefined),
        new Column(db, "bank_id", "varchar", 32, false, undefined)
    ]);
    db.put(withdraw);

    var banner = new Table(db, "banner", [
        new Column(db, "id", "varchar", 32, false, undefined, true, false),
        new Column(db, "description", "varchar", 500, false, undefined)
    ]);
    db.put(banner);


    var banner_picture = new Table(db, "banner_picture", [
        new Column(db, "id", "varchar", 32, false, undefined, true, false),
        new Column(db, "banner_id", "varchar", 32, false, undefined),
        new Column(db, "picture", "varchar", 300, false, undefined),
        new Column(db, "title", "varchar", 255, false, undefined),
        new Column(db, "url", "varchar", 255, false, undefined),
        new Column(db, "is_out_site", "int", -1, false, undefined),
        new Column(db, "seq_num", "int", -1, false, undefined)
    ]);
    db.put(banner_picture);



    var bank_card = new Table(db, "bank_card", [
        new Column(db, "id", "varchar", 32, false, undefined, true, false),
        new Column(db, "user_id", "varchar", 32, false, undefined),
        new Column(db, "name", "varchar", 32, false, undefined),
        new Column(db, "card_no", "varchar", 32, false, undefined),
        new Column(db, "bank_code", "varchar", 32, false, undefined),
        new Column(db, "create_time", "date", -1, false, undefined),
        new Column(db, "update_time", "date", -1, false, undefined),
        new Column(db, "status", "int", -1, false, undefined)
    ]);
    db.put(bank_card);


    var fee_config = new Table(db, "fee_config", [
        new Column(db, "id", "varchar", 32, false, undefined, true, false),
        new Column(db, "node", "varchar", 32, false, undefined),
        new Column(db, "name", "varchar", 32, false, undefined),
        new Column(db, "money", "int", -1, false, undefined),
        new Column(db, "type", "varchar", 32, false, undefined),
        new Column(db, "description", "varchar", 1000, false, undefined),
        new Column(db, "create_time", "date", -1, false, undefined)
    ]);
    db.put(fee_config);


    var person_info = new Table(db, "person_info", [
        new Column(db, "id", "varchar", 32, false, undefined, true, false),
        new Column(db, "user_id", "varchar", 32, false, undefined, true, false),
        new Column(db, "root_provice", "varchar", 18, false, undefined),
        new Column(db, "root_city", "varchar", 18, false, undefined),
        new Column(db, "root_dist", "varchar", 18, false, undefined),
        new Column(db, "home_provice", "varchar", 18, false, undefined),
        new Column(db, "home_city", "varchar", 18, false, undefined),
        new Column(db, "home_dist", "varchar", 18, false, undefined),
        new Column(db, "address", "varchar", 32, false, undefined),
        new Column(db, "education", "varchar", 32, false, undefined),
        new Column(db, "school_time", "varchar", 32, false, undefined),
        new Column(db, "house_status", "int", -1, false, undefined),
        new Column(db, "house_loan_status", "int", -1, false, undefined),
        new Column(db, "car_status", "int", -1, false, undefined),
        new Column(db, "car_loan_status", "int", -1, false, undefined),
        new Column(db, "child_status", "int", -1, false, undefined),
        new Column(db, "married", "varchar", 10, false, undefined),
        new Column(db, "kinfolk_one_name", "varchar", 18, false, undefined),
        new Column(db, "kinfolk_one_relation", "varchar", 18, false, undefined),
        new Column(db, "kinfolk_one_mobile", "varchar", 18, false, undefined),
        new Column(db, "kinfolk_two_name", "varchar", 18, false, undefined),
        new Column(db, "kinfolk_two_relation", "varchar", 18, false, undefined),
        new Column(db, "kinfolk_two_mobile", "varchar", 18, false, undefined),
        new Column(db, "create_time", "date", -1, false, undefined),
        new Column(db, "update_time", "date", -1, false, undefined)
    ]);
    db.put(person_info);


    var person_work = new Table(db, "person_work", [
        new Column(db, "id", "varchar", 32, false, undefined, true, false),
        new Column(db, "user_id", "varchar", 32, false, undefined, true, false),
        new Column(db, "work", "varchar", 32, false, undefined),
        new Column(db, "company", "varchar", 32, false, undefined),
        new Column(db, "company_provice", "varchar", 32, false, undefined),
        new Column(db, "company_city", "varchar", 32, false, undefined),
        new Column(db, "company_trade", "varchar", 32, false, undefined),
        new Column(db, "company_type", "varchar", 32, false, undefined),
        new Column(db, "company_size", "varchar", 32, false, undefined),
        new Column(db, "company_time", "varchar", 32, false, undefined),
        new Column(db, "company_position", "varchar", 32, false, undefined),
        new Column(db, "company_money", "varchar", 32, false, undefined),
        new Column(db, "get_money_type", "varchar", 32, false, undefined),
        new Column(db, "cureent_time", "varchar", 32, false, undefined),
        new Column(db, "tel", "varchar", 32, false, undefined),
        new Column(db, "email", "varchar", 32, false, undefined),
        new Column(db, "address", "varchar", 32, false, undefined),
        new Column(db, "create_time", "date", -1, false, undefined),
        new Column(db, "update_time", "date", -1, false, undefined)
    ]);
    db.put(person_work);



    var picture = new Table(db, "picture", [
        new Column(db, "id", "varchar", 32, false, undefined, true, false),
        new Column(db, "outer_id", "varchar", 32, false, undefined),
        new Column(db, "type", "varchar", 32, false, undefined),
        new Column(db, "url", "varchar", 32, false, undefined),
        new Column(db, "create_time", "date", -1, false, undefined)
    ]);
    db.put(picture);


    var person_loan = new Table(db, "person_loan", [
        new Column(db, "id", "varchar", 32, false, undefined, true, false),
        new Column(db, "name", "varchar", 32, false, undefined),
        new Column(db, "borrow_user_id", "varchar", 32, false, undefined),
        new Column(db, "loan_uses", "varchar", 100, false, undefined),
        new Column(db, "description", "varchar", 1000, false, undefined),
        new Column(db, "repay_type", "varchar", 32, false, undefined),
        new Column(db, "loan_type", "varchar", 32, false, undefined),
        new Column(db, "status", "int", -1, false, undefined),
        new Column(db, "deadline", "int", -1, false, undefined),
        new Column(db, "money", "int", -1, false, undefined),
        new Column(db, "rate", "double", -1, false, undefined),
        new Column(db, "create_time", "date", -1, false, undefined)
    ]);
    db.put(person_loan);


    var creditor_loan = new Table(db, "creditor_loan", [
        new Column(db, "id", "varchar", 32, false, undefined, true, false),
        new Column(db, "loan_id", "varchar", 32, false, undefined, true, false),
        new Column(db, "invest_id", "varchar", 32, false, undefined, true, false),
        new Column(db, "creditor_invest_id", "varchar", 32, false, undefined, true, false),
        new Column(db, "creditor_type", "varchar", 32, false, undefined, true, false),
        new Column(db, "creditor_value", "double", -1, false, undefined),
        new Column(db, "creditor_value_update", "double", -1, false, undefined),
        new Column(db, "total_price", "double", -1, false, undefined),
        new Column(db, "tran_price", "double", -1, false, undefined),
        new Column(db, "actual_rate", "double", -1, false, undefined),
        new Column(db, "actual_money_part", "double", -1, false, undefined),
        new Column(db, "tran_user_id", "varchar", 32, false, undefined, true, false),
        new Column(db, "status", "int", -1, false, undefined),
        new Column(db, "create_time", "date", -1, false, undefined),
        new Column(db, "disc_price", "double", -1, false, undefined),
        new Column(db, "disc_rate", "double", -1, false, undefined),
        new Column(db, "start_time", "date", -1, false, undefined),
        new Column(db, "end_time", "date", -1, false, undefined),
        new Column(db, "termi_time", "date", -1, false, undefined),
        new Column(db, "update_time", "date", -1, false, undefined)
    ]);
    db.put(creditor_loan);

    var creditor_invest = new Table(db, "creditor_invest", [
        new Column(db, "id", "varchar", 32, false, undefined, true, false),
        new Column(db, "loan_id", "varchar", 32, false, undefined, true, false),
        new Column(db, "money", "double", -1, false, undefined),
        new Column(db, "accept_money", "double", -1, false, undefined),
        new Column(db, "disc_money", "double", -1, false, undefined),
        new Column(db, "interest", "double", -1, false, undefined),
        new Column(db, "creditor_man_fee", "double", -1, false, undefined),
        new Column(db, "creditor_value", "double", -1, false, undefined),
        new Column(db, "status", "int", -1, false, undefined),
        new Column(db, "rate", "double", -1, false, undefined),
        new Column(db, "create_time", "date", -1, false, undefined),
        new Column(db, "update_time", "date", -1, false, undefined),
        new Column(db, "creditor_loan_id", "double", -1, false, undefined),
        new Column(db, "user_id", "varchar", 32, false, undefined, true, false)
    ]);
    db.put(creditor_invest);

    var creditor_invest_repay = new Table(db, "creditor_invest_repay", [
        new Column(db, "id", "varchar", 32, false, undefined, true, false),
        new Column(db, "money", "double", -1, false, undefined),
        new Column(db, "interest", "double", -1, false, undefined),
        new Column(db, "tran_money", "double", -1, false, undefined),
        new Column(db, "tran_interest", "double", -1, false, undefined),
        new Column(db, "creditor_repay_day", "date", -1, false, undefined),
        new Column(db, "creditor_invest_id", "varchar", 32, false, undefined, true, false),
        new Column(db, "period", "int", -1, false, undefined),
        new Column(db, "all_period", "int", -1, false, undefined),
        new Column(db, "create_time", "date", -1, false, undefined),
        new Column(db, "status", "int", -1, false, undefined),
    ]);
    db.put(creditor_invest_repay);

    var creditor_config = new Table(db, "creditor_config", [
        new Column(db, "id", "varchar", 32, false, undefined, true, false),
        new Column(db, "creditor_type", "varchar", 32, false, undefined, true, false),
        new Column(db, "buy_loan_days", "int", -1, false, undefined),
        new Column(db, "nums", "int", -1, false, undefined),
        new Column(db, "interva", "int", -1, false, undefined),
        new Column(db, "period", "int", -1, false, undefined),
        new Column(db, "tran_repay", "int", -1, false, undefined),
        new Column(db, "tran_apply_cur_repay", "int", -1, false, undefined),
        new Column(db, "acro_repay_tran_effec", "int", -1, false, undefined),
        new Column(db, "sur_period_debx", "int", -1, false, undefined),
        new Column(db, "sur_period_other", "int", -1, false, undefined),
        new Column(db, "creditor_min_money", "double", -1, false, undefined),
        new Column(db, "creditor_mange_money", "double", -1, false, undefined),
        new Column(db, "discount_range", "double", -1, false, undefined),
        new Column(db, "create_time", "date", -1, false, undefined)
    ]);
    db.put(creditor_config);

    var config = new Table(db, "config", [
        new Column(db, "id", "varchar", 32, false, undefined, true, false),
        new Column(db, "name", "varchar", 32, false, undefined),
        new Column(db, "value", "varchar", 1000, false, undefined),
        new Column(db, "description", "varchar", 1000, false, undefined),
        new Column(db, "type", "varchar", 32, false, undefined)
    ]);
    db.put(config);


    var local_date = new Table(db, "local_date", [
        new Column(db, "id", "varchar", 8, false, undefined, true, false),
        new Column(db, "year", "varchar", 4, false, undefined),
        new Column(db, "month", "varchar", 2, false, undefined),
        new Column(db, "day", "varchar", 2, false, undefined),
        new Column(db, "week", "varchar", 1, false, undefined),
        new Column(db, "status", "int", -1, false, undefined)
    ]);
    db.put(local_date);



    self.main = db;
    self.main.init(cb);
};


DbCenter.prototype._initMg = function (cb) {
    var self = this;
    var db = new Database(prop.mg);
    //add tables
    var customer = new Table(db, "customer", [
        new Column(db, "_id", "bigint", -1, false, undefined, true, true),
        new Column(db, "userId", "varchar", 10, false, undefined),
        new Column(db, "name", "varchar", 10, false, undefined),
        new Column(db, "st", "varchar", 32, false, undefined),
        new Column(db, "type", "bigint", -1, false, undefined),
        new Column(db, "createTime", "date", -1, false, undefined)
    ]);
    db.put(customer);

    var mcp_id = new Table(db, "mcp_id", [
        new Column(db, "_id", "varchar", 80, false, undefined, true, false),
        new Column(db, "value", "bigint", -1, false, undefined),
        new Column(db, "version", "int", 11, false, 0)
    ]);
    db.put(mcp_id);

    var task = new Table(db, "task", [
        new Column(db, "_id", "bigint", -1, false, undefined, true, true),
        new Column(db, "loan_id", "varchar", 80, false, undefined),
        new Column(db, "description", "varchar", 200, false, undefined),
        new Column(db, "type", "bigint", -1, false, undefined),
        new Column(db, "fireTime", "date", -1, false, undefined)
    ]);
    db.put(task);


    var userbill = new Table(db, "userbill", [
        new Column(db, "_id", "bigint", -1, false, undefined, true, true),
        new Column(db, "transType", "varchar", 20, false, undefined),
        new Column(db, "payType", "varchar", 20, false, undefined),
        new Column(db, "money", "int", 11, false, undefined),
        new Column(db, "proMoney", "int", 11, false, undefined),
        new Column(db, "afterMoney", "int", 11, false, undefined),
        new Column(db, "frozeMoney", "int", 11, false, undefined),
        new Column(db, "create_time", "date", -1, false, undefined),
        new Column(db, "username", "varchar", 32, false, undefined),
        new Column(db, "user_id", "varchar", 32, false, undefined)
    ]);
    db.put(userbill);

    self.mg = db;
    self.mg.init(cb);
};


DbCenter.prototype._checkMain = function (cb) {
    var self = this;
    cb(null);
};

DbCenter.prototype._checkMg = function (cb) {
    var self = this;
    var kvTable = self.mg.get("mcp_id");
    async.waterfall([
        function (cb) {
            kvTable.findOne({_id: "loanId"}, {}, [], function (err, data) {
                if (err) {
                    cb(err);
                }
                if (!data) {
                    kvTable.save({_id: "loanId", value: 1}, [], function (err, data) {
                        cb(err);
                    });
                }
                else {
                    cb(null);
                }
            });
        },
        function (cb) {
            kvTable.findOne({_id: "investId"}, {}, [], function (err, data) {
                if (err) {
                    cb(err);
                    return;
                }
                if (!data) {
                    kvTable.save({_id: "investId", value: 1}, [], function (err, data) {
                        cb(err);
                    });
                }
                else {
                    cb(null);
                }
            });
        }
    ], function (err, result) {
        cb(err);
    });


};


module.exports = new DbCenter();

