var dc = require('mcp_db').dc;
var util = require('easy_util');
var dateUtil = util.dateUtil;

var KvService = function () {
};

KvService.prototype.getLoanId = function (cb) {

    var kvTable = dc.mg.get("mcp_id");
    var id = "loanId";
    kvTable.findAndModify({_id: id}, {}, {$inc: {value: 1}}, {upsert: true, new: true}, function (err, data) {
        if (err) {
            cb(err, data);
        } else {
            cb(err, dateUtil.toCurrentDate() + data.value.toString());
        }

    });
};


KvService.prototype.getInvestId = function (cb) {
    var kvTable = dc.mg.get("mcp_id");
    var id = "investId";
    kvTable.findAndModify({_id: id}, {}, {$inc: {value: 1}}, {upsert: true, new: true}, function (err, data) {
        if (err) {
            cb(err, data);
        } else {
            cb(err, dateUtil.toCurrentDate() + data.value.toString());
        }
    });
};


module.exports = new KvService();