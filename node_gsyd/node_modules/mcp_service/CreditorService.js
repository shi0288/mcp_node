/**
 * Created by liujun on 2016/7/21.
 */
var dc = require('mcp_db').dc;

var esul = require('easy_util');
var digestUtil = esul.digestUtil;

var util = require('mcp_util');
var objectUtil = util.objectUtil;

var async = require('async');

var CreditorService = function () {
};

/**
 * 获取当前还款日
 * @param loan_id
 */
CreditorService.prototype.getCurRepayDay = function (loan_id, cb) {
    var conn = dc.main.getConn();
    var sql = "SELECT * FROM loan_repay WHERE loan_id = " + loan_id + " AND status =  1 ORDER BY create_time LIMIT 1";
        conn.execute(sql, [], function (err, data) {
            cb(err, data[0]);
        });
    return;
};

/**
 * 购买债权处理
 * @param money
 * @param userID
 * @param accept_money
 * @param sur_money
 * @param id
 * @param status
 * @param create_time
 * @param creditor_loan_id
 * @param user_id
 * @param cb
 */
CreditorService.prototype.buyTran = function (money, userID, accept_money,sur_money,id,status,create_time,creditor_loan_id,user_id,  cb) {
    var conn = dc.main.getConn();
    var sql = "UPDATE account SET money = " + sur_money + " WHERE user_id = '" + userID + "' ";
    var sql2 = "insert INTO creditor_invest(id, money,status,create_time,user_id,creditor_loan_id) VALUES (" +
         id + "," + money + "," + status + ", '" + create_time + "'" + ", '" + user_id + "'" + ", '" + creditor_loan_id + "'" +
    ");";
    var sql3 = "";
    conn.execute(sql, [], function (err, data) {
        if(err) {
            console.log(err);
        }else {
            conn.execute(sql2, [], function (err, data) {
                if(err) {
                    console.log(err);
                }else {
                    conn.execute(sql3, [], function (err, data) {
                      if(err) {
                          console.log(err);
                      } else {
                          console.log("sql执行成功");
                      }
                    });
                }
            })
        }
    });
};

module.exports = new CreditorService();